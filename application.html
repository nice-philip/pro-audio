<!DOCTYPE html>
<html lang="ja-JP">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アルバム申請 - Surroundio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/application.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AUAys9sigvI9TtgDkQMRtQxfrXspOUiEp9CUafMtSagb2r_Av6rYByXOrkRkQIg7weOtYlGKfJMxRuK_&currency=JPY&intent=capture"></script>
    <style>
        /* Base styles */
        
        body {
            font-size: 16px;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
        }
        
        .form-section {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        /* Mobile-first styles */
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .form-section {
                padding: 15px;
                margin-bottom: 15px;
            }
            h1 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            h3 {
                font-size: 1.2rem;
                margin-bottom: 0.8rem;
            }
            h4 {
                font-size: 1.1rem;
            }
            .form-label {
                font-size: 0.9rem;
                margin-bottom: 0.3rem;
            }
            .form-control {
                font-size: 16px;
                /* Prevents iOS zoom on focus */
                padding: 0.5rem;
                height: auto;
            }
            .input-group {
                margin-bottom: 0.8rem;
            }
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            /* Improve touch targets */
            .form-check-input {
                width: 1.2rem;
                height: 1.2rem;
                margin-top: 0.2rem;
            }
            .form-check-label {
                padding-left: 0.5rem;
                font-size: 0.9rem;
            }
            /* Accordion improvements */
            .accordion-button {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            .accordion-body {
                padding: 0.8rem;
            }
            /* Platform selection improvements */
            .platform-section .form-check {
                margin-bottom: 0.5rem;
            }
            /* Song entry improvements */
            .song-entry {
                padding: 15px;
                margin-bottom: 15px;
            }
            .song-entry h4 {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }
            /* Duration input improvements */
            .duration-input-group {
                display: flex;
                gap: 5px;
            }
            .duration-input-group input {
                width: 60px;
            }
            /* File upload improvements */
            .custom-file-label {
                font-size: 0.9rem;
                padding: 0.5rem;
            }
            /* Enhanced file upload styles */
            .file-upload-section {
                position: relative;
                margin-bottom: 1rem;
            }
            .file-upload-section input[type="file"] {
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                opacity: 0;
                cursor: pointer;
                z-index: 2;
            }
            .file-upload-section .upload-button {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
                background: #f8f9fa;
                border: 2px dashed #dee2e6;
                border-radius: 8px;
                transition: all 0.3s ease;
            }
            .file-upload-section .upload-button:hover {
                background: #e9ecef;
                border-color: #adb5bd;
            }
            .file-upload-section .upload-button i {
                margin-right: 0.5rem;
                font-size: 1.2rem;
            }
            .file-upload-section .file-info {
                margin-top: 0.5rem;
                font-size: 0.9rem;
                color: #6c757d;
            }
            .file-upload-section .file-preview {
                margin-top: 1rem;
                max-width: 100%;
                height: auto;
                border-radius: 4px;
                display: none;
            }
            .file-upload-section .file-preview img {
                max-width: 100%;
                height: auto;
                border-radius: 4px;
            }
            .file-upload-section .file-preview audio {
                width: 100%;
                margin-top: 0.5rem;
            }
            .file-upload-section .remove-file {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
                background: rgba(255, 255, 255, 0.9);
                border: none;
                border-radius: 50%;
                width: 24px;
            }
            .btn-group {
                display: flex;
                width: 100%;
            }
            .btn-group .btn {
                flex: 1;
            }
            /* Improve checkbox and radio button touch areas */
            .form-check {
                padding-left: 1.5rem;
            }
            .form-check-input {
                margin-left: -1.5rem;
            }
            /* Improve select dropdowns */
            .form-select {
                padding-right: 2rem;
            }
            /* Improve file inputs */
            input[type="file"] {
                font-size: 0.9rem;
            }
            /* Improve accordion touch areas */
            .accordion-button::after {
                width: 1.2rem;
                height: 1.2rem;
            }
        }
        /* Prevent zoom on input focus for iOS */
        
        @supports (-webkit-touch-callout: none) {
            input[type="text"],
            input[type="email"],
            input[type="password"],
            input[type="number"],
            input[type="date"],
            select,
            textarea {
                font-size: 16px;
            }
        }
        /* Improve scrolling performance */
        
        * {
            -webkit-overflow-scrolling: touch;
        }
        /* Improve button feedback */
        
        .btn:active {
            transform: scale(0.98);
        }
        /* Improve form validation visibility */
        
        .is-invalid {
            border-color: #dc3545;
        }
        
        .invalid-feedback {
            font-size: 0.8rem;
            margin-top: 0.2rem;
        }
        /* Improve loading states */
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        /* Improve focus states for accessibility */
        
        .form-control:focus,
        .form-select:focus,
        .btn:focus {
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        .audio-specs-table {
            width: 100%;
            margin: 20px 0;
        }
        
        .audio-specs-table th,
        .audio-specs-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        .audio-specs-table th {
            background-color: #f8f9fa;
        }
        
        .youtube-terms {
            height: 200px;
            overflow-y: scroll;
            padding: 15px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .required-label::after {
            content: "*";
            color: red;
            margin-left: 4px;
        }
        
        .image-upload-guide {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .classic-fields {
            display: none;
        }
        
        #genre {
            max-height: 38px;
        }
        /* Pastel button styles */
        
        .btn-pastel {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none !important;
            display: inline-block;
            margin: 5px;
            color: #2C3333 !important;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        @media (max-width: 768px) {
            .btn-pastel {
                width: 100%;
                margin: 10px 0;
                padding: 15px 25px;
                font-size: 16px;
                position: relative;
                z-index: 1;
            }
        }
        
        .classical-required::after {
            content: "*";
            color: red;
            margin-left: 4px;
        }
        /* PayPal Button Styles */
        
        #paypal-button-container {
            max-width: 500px;
            margin: 20px auto;
        }
        
        .payment-status {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .payment-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .payment-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .add-button {
            background: #C1FFD7;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            cursor: pointer;
        }
        
        .add-button:hover {
            background: #B4EBC5;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        .checkbox-group {
            margin: 15px 0;
        }
        
        .language-section {
            margin: 20px 0;
        }
        
        .platform-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .terms-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        
        .terms-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            margin: 10px 0;
            background: white;
            border: 1px solid #ddd;
        }
        
        .image-upload-info {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .dynamic-input-container {
            margin-top: 10px;
        }
        
        .remove-input {
            color: red;
            cursor: pointer;
            margin-left: 10px;
        }
        /* Add these styles to the existing style section */
        
        #submitButton {
            position: relative;
            z-index: 999;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 44px;
            min-width: 44px;
            padding: 12px 30px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        #submitButton:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }
        
        #submitButton .spinner-border {
            width: 1rem;
            height: 1rem;
            margin-left: 0.5rem;
        }
        /* Success modal styles */
        
        .modal-dialog-centered {
            display: flex;
            align-items: center;
            min-height: calc(100% - 1rem);
        }
        
        @media (max-width: 768px) {
            #submitButton {
                width: 100%;
                padding: 15px 30px;
                font-size: 1.2rem;
            }
            .modal-dialog {
                margin: 1rem;
            }
            .modal-content {
                border-radius: 1rem;
            }
            .modal-body {
                padding: 1.5rem;
            }
            .modal-footer {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="container my-5">
        <div id="error-message" class="alert alert-danger" style="display: none;"></div>
        <div id="success-message" class="alert alert-success" style="display: none;"></div>
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="/index" class="btn btn-outline-primary">
                <i class="fa fa-home"></i> <span>ホームへ戻る</span>
            </a>
            <h1 class="mb-0">アルバム申請</h1>
            <div style="width: 100px;"></div>
        </div>
        <form id="albumForm" class="needs-validation" novalidate>
            <!-- 基本情報 -->
            <div class="form-section">
                <h3 class="mb-4">基本情報</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="releaseDate" class="form-label required-label">配信開始希望日</label>
                        <input type="date" class="form-control" id="releaseDate" name="releaseDate" required>
                        <small class="text-muted">配信開始は本日から3週間以降の日付を選択してください</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label required-label">メールアドレス</label>
                        <input type="email" class="form-control" id="email" name="email" autocomplete="username" required>
                        <div class="invalid-feedback">
                            有効なメールアドレスを入力してください（@を含む必要があります）
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="password" class="form-label required-label">パスワード</label>
                        <input type="password" class="form-control" id="password" name="password" autocomplete="current-password" required>
                        <div class="invalid-feedback">
                            パスワードを入力してください
                        </div>
                        <small class="text-muted">予約確認時に必要となります</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="albumNameDomestic" class="form-label required-label">アルバム名（日本語）</label>
                        <input type="text" class="form-control" id="albumNameDomestic" name="albumNameDomestic" placeholder="アルバム名を入力してください" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="albumNameInternational" class="form-label required-label">アルバム名（English）</label>
                        <input type="text" class="form-control" id="albumNameInternational" name="albumNameInternational" placeholder="Enter album name in English" required>
                    </div>
                </div>
            </div>

            <!-- アルバム情報 -->
            <div class="form-section">
                <h3 class="mb-4">アルバム情報</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="albumTitle">アルバムタイトル (日本語)</label>
                        <input type="text" id="albumTitle" name="albumTitle" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="nameEn">アルバムタイトル (English)</label>
                        <input type="text" id="nameEn" name="nameEn" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="nameKana">アルバムタイトル (カナ)</label>
                        <input type="text" id="nameKana" name="nameKana" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="artistInfo">アーティスト情報</label>
                        <textarea id="artistInfo" name="artistInfo" class="form-control" required></textarea>
                    </div>
                </div>
            </div>

            <!-- 楽曲情報 -->
            <div class="form-section">
                <h3 class="mb-4">楽曲情報</h3>
                <button type="button" class="btn btn-success mb-3" id="addSongButton">
                    <i class="fa fa-plus"></i> 楽曲を追加
                </button>
                <div id="songs-container">
                    <!-- Template for song entry -->
                    <div class="song-entry mb-4 p-3 border rounded" data-song-index="0">
                        <h4 class="d-flex justify-content-between align-items-center">
                            楽曲 #<span class="song-number">1</span>
                            <button type="button" class="btn btn-danger remove-song" style="display: none;">
                                <i class="fa fa-trash"></i>
                            </button>
                        </h4>

                        <!-- 楽曲基本情報 -->
                        <div class="song-basic-info mb-4">
                            <h5>楽曲基本情報</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label required-label">楽曲タイトル (日本語)</label>
                                    <input type="text" name="title_0" class="form-control" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label required-label">楽曲タイトル (English)</label>
                                    <input type="text" name="titleEn_0" class="form-control" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label required-label">再生時間</label>
                                    <div class="input-group">
                                        <input type="number" name="duration_min_0" class="form-control" placeholder="分" min="0" required>
                                        <span class="input-group-text">分</span>
                                        <input type="number" name="duration_sec_0" class="form-control" placeholder="秒" min="0" max="59" required>
                                        <span class="input-group-text">秒</span>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label required-label">ジャンル</label>
                                    <select class="form-select" name="genre_0" required>
                                        <option value="" disabled selected>ジャンルを選択してください</option>
                                        <option value="rock">ロック (Rock)</option>
                                        <option value="pop">ポップ (Pop)</option>
                                        <option value="jazz">ジャズ (Jazz)</option>
                                        <option value="classical">クラシック (Classical)</option>
                                        <option value="electronic">エレクトロニック (Electronic)</option>
                                        <option value="hiphop">ヒップホップ (Hip-Hop)</option>
                                        <option value="country">カントリー (Country)</option>
                                        <option value="experimental">エクスペリメンタル (Experimental)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- アーティスト情報 -->
                        <div class="artist-section mb-4">
                            <h5>アーティスト情報</h5>
                            <div id="mainArtistContainer_0" class="mb-3">
                                <label class="form-label required-label">メインアーティスト</label>
                                <div class="input-group">
                                    <input type="text" name="mainArtist_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="participatingArtistContainer_0" class="mb-3">
                                <label class="form-label required-label">参加アーティスト</label>
                                <div class="input-group">
                                    <input type="text" name="participatingArtist_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="featuringContainer_0" class="mb-3">
                                <label class="form-label">フィーチャリングアーティスト</label>
                                <div class="input-group">
                                    <input type="text" name="featuring_0[]" class="form-control">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="mixingEngineerContainer_0" class="mb-3">
                                <label class="form-label required-label">ミキシングエンジニア</label>
                                <div class="input-group">
                                    <input type="text" name="mixingEngineer_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="recordingEngineerContainer_0" class="mb-3">
                                <label class="form-label required-label">レコーディングエンジニア</label>
                                <div class="input-group">
                                    <input type="text" name="recordingEngineer_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="producerContainer_0" class="mb-3">
                                <label class="form-label required-label">プロデューサー</label>
                                <div class="input-group">
                                    <input type="text" name="producer_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 作者情報 -->
                        <div class="creator-section mb-4">
                            <h5>作者情報</h5>
                            <div id="lyricistContainer_0" class="mb-3">
                                <label class="form-label required-label">作詞</label>
                                <div class="input-group">
                                    <input type="text" name="lyricist_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="composerContainer_0" class="mb-3">
                                <label class="form-label required-label">作曲</label>
                                <div class="input-group">
                                    <input type="text" name="composer_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>

                            <div id="arrangerContainer_0" class="mb-3">
                                <label class="form-label required-label">編曲</label>
                                <div class="input-group">
                                    <input type="text" name="arranger_0[]" class="form-control" required>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success add-field">+</button>
                                        <button type="button" class="btn btn-danger remove-field">-</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- その他の情報 -->
                        <div class="other-info-section">
                            <h5>その他の情報</h5>
                            <div class="mb-3">
                                <label class="form-label required-label">音声ファイル（WAV形式）</label>
                                <input type="file" class="form-control" name="audioFiles" accept=".wav" required>
                                <div class="alert alert-warning mt-2">
                                    <p class="text-danger">※ 音声ファイルは以下の規格を必ず守ってください：</p>
                                    <ul>
                                        <li>ファイル形式: WAV</li>
                                        <li>サンプリングレート: 44.1kHz または 48kHz</li>
                                        <li>ビット深度: 16bit または 24bit</li>
                                        <li>チャンネル: ステレオ</li>
                                        <li>ファイルサイズ: 2GB以下</li>
                                    </ul>
                                    <p>※ 音声ファイルが規格外の場合、音質の低下や処理の遅延が発生する可能性があります。</p>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label required-label">リメイク曲ですか？</label>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="isRemake_0" value="yes" required>
                                    <label class="form-check-label">はい</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="isRemake_0" value="no" required>
                                    <label class="form-check-label">いいえ</label>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">外部購入ビート/サンプルを使用していますか？</label>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="usesExternalBeat_0" value="yes" required>
                                    <label class="form-check-label">はい</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="usesExternalBeat_0" value="no" required>
                                    <label class="form-check-label">いいえ</label>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label required-label">言語</label>
                                <div class="accordion" id="languageAccordion_0">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="languageHeading_0">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#languageCollapse_0" aria-expanded="false" aria-controls="languageCollapse_0">
                                                言語を選択
                                            </button>
                                        </h2>
                                        <div id="languageCollapse_0" class="accordion-collapse collapse" aria-labelledby="languageHeading_0" data-bs-parent="#languageAccordion_0">
                                            <div class="accordion-body">
                                                <select class="form-select" name="language_0" required>
                                                    <option value="instrumental">演奏（言語なし）</option>
                                                    <option value="japanese">日本語</option>
                                                    <option value="english">英語</option>
                                                    <option value="korean">韓国語</option>
                                                    <option value="chinese">中国語</option>
                                                    <option value="spanish">スペイン語</option>
                                                    <option value="french">フランス語</option>
                                                    <option value="german">ドイツ語</option>
                                                    <option value="italian">イタリア語</option>
                                                    <option value="portuguese">ポルトガル語</option>
                                                    <option value="russian">ロシア語</option>
                                                    <option value="arabic">アラビア語</option>
                                                    <option value="hindi">ヒンディー語</option>
                                                    <option value="bengali">ベンガル語</option>
                                                    <option value="punjabi">パンジャブ語</option>
                                                    <option value="javanese">ジャワ語</option>
                                                    <option value="vietnamese">ベトナム語</option>
                                                    <option value="thai">タイ語</option>
                                                    <option value="turkish">トルコ語</option>
                                                    <option value="persian">ペルシャ語</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">歌詞</label>
                                <textarea class="form-control" name="lyrics_0" rows="5" placeholder="歌詞を入力してください"></textarea>
                                <div class="alert alert-warning mt-2">
                                    <p>- 歌詞に性的な内容や暴言が含まれている場合、禁止事項をチェックしてください。</p>
                                    <p>- 歌詞に性的な内容や暴言が含まれているにもかかわらず禁止事項のチェックがない場合、当社の方針により歌詞サービスが制限される可能性があります。</p>
                                    <p>- 商標が歌詞に含まれる場合、各プラットフォームの方針により歌詞サービスが制限される可能性があります。</p>
                                </div>
                                <div class="form-check mt-2">
                                    <input type="checkbox" class="form-check-input" name="hasExplicitContent_0">
                                    <label class="form-check-label">歌詞に性的な内容や暴言が含まれています</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- アルバム全体の情報 -->
            <div class="form-section">
                <h3>アルバム全体の情報</h3>
                <div class="mb-3">
                    <label for="albumCover" class="form-label required-label">アルバムカバー</label>
                    <input type="file" class="form-control" id="albumCover" name="albumCover" accept=".jpg,.jpeg,.png" required>
                    <div class="alert alert-warning mt-2">
                        <p class="text-danger">※ 商標や商用イメージは使用できません</p>
                        <p><strong>アルバムカバーは以下の規格を必ず守ってください：</strong></p>
                        <ul>
                            <li>サイズ: 3,000 x 3,000 ピクセル（正方形）</li>
                            <li>ファイル形式: JPG または PNG</li>
                            <li>ファイルサイズ: 10MB以下</li>
                        </ul>
                        <p>※ 規格外の画像は自動的にリサイズされ、画質が低下する可能性があります。</p>
                    </div>
                </div>

                <!-- 同意事項 -->
                <div class="terms-section">
                    <h4>同意事項</h4>
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" name="rightsAgreement" required>
                        <label class="form-check-label">所有権等権利紛争に関する全ての情報に同意します。</label>
                        <div class="terms-content">
                            <p>本有料サービスは、有料利用会員の発売履歴が存在しない、新規の純粋な創作物を対象としています。</p>
                            <p>会員は、流通対象コンテンツに関して、当社に独占的な流通事業権を付与するために必要な適法な著作権、著作隣接権、商標権、意匠権、パブリシティ権等の権利および／または本有料サービスの契約期間中有効な関連使用権限を有していることを保証します。</p>
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" name="reReleaseAgreement" required>
                        <label class="form-check-label">他社発売音源の再発売に関する情報に同意します。</label>
                        <div class="terms-content">
                            <p>本有料サービスでは、過去に他社にて発売または流通された経歴があるコンテンツの重複発売を許可いたしません。</p>
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" name="platformAgreement" required>
                        <label class="form-check-label">発売国及びプラットフォームに関する情報に同意します。</label>
                        <div class="terms-content">
                            <p>本有料サービスは、有料利用会員が登録・発売したコンテンツを、当社とコンテンツ流通契約関係にあるすべてのDSPおよび各DSPがサービスを提供する全地域に対して流通・供給することを原則とします。</p>
                        </div>
                    </div>
                </div>

                <!-- プラットフォーム選択 -->
                <div class="platform-section">
                    <h4>発売を希望するプラットフォーム</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="spotify">
                                <label class="form-check-label">Spotify</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="apple_music">
                                <label class="form-check-label">Apple Music</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="youtube_music">
                                <label class="form-check-label">YouTube Music</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="amazon_music">
                                <label class="form-check-label">Amazon Music</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="tidal">
                                <label class="form-check-label">TIDAL</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="deezer">
                                <label class="form-check-label">Deezer</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="pandora">
                                <label class="form-check-label">Pandora</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="soundcloud">
                                <label class="form-check-label">SoundCloud</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="napster">
                                <label class="form-check-label">Napster</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="anghami">
                                <label class="form-check-label">Anghami</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="joox">
                                <label class="form-check-label">JOOX</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="kkbox">
                                <label class="form-check-label">KKBOX</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="line_music">
                                <label class="form-check-label">LINE MUSIC</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="qq_music">
                                <label class="form-check-label">QQ Music</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" name="platforms[]" value="netease">
                                <label class="form-check-label">NetEase Cloud Music</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 除外国選択 -->
                <div class="form-section">
                    <h3>発売を希望しない国</h3>
                    <div class="accordion" id="excludedCountriesAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="asiaHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#asiaCollapse" aria-expanded="false" aria-controls="asiaCollapse">
                                    アジア
                                </button>
                            </h2>
                            <div id="asiaCollapse" class="accordion-collapse collapse" aria-labelledby="asiaHeading" data-bs-parent="#excludedCountriesAccordion">
                                <div class="accordion-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="JP">
                                                <label class="form-check-label">日本</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="CN">
                                                <label class="form-check-label">中国</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="KR">
                                                <label class="form-check-label">韓国</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="TW">
                                                <label class="form-check-label">台湾</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="HK">
                                                <label class="form-check-label">香港</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="SG">
                                                <label class="form-check-label">シンガポール</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="MY">
                                                <label class="form-check-label">マレーシア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="ID">
                                                <label class="form-check-label">インドネシア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="TH">
                                                <label class="form-check-label">タイ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="VN">
                                                <label class="form-check-label">ベトナム</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="PH">
                                                <label class="form-check-label">フィリピン</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="IN">
                                                <label class="form-check-label">インド</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="PK">
                                                <label class="form-check-label">パキスタン</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="BD">
                                                <label class="form-check-label">バングラデシュ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="LK">
                                                <label class="form-check-label">スリランカ</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="europeHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#europeCollapse" aria-expanded="false" aria-controls="europeCollapse">
                                    ヨーロッパ
                                </button>
                            </h2>
                            <div id="europeCollapse" class="accordion-collapse collapse" aria-labelledby="europeHeading" data-bs-parent="#excludedCountriesAccordion">
                                <div class="accordion-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="GB">
                                                <label class="form-check-label">イギリス</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="FR">
                                                <label class="form-check-label">フランス</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="DE">
                                                <label class="form-check-label">ドイツ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="IT">
                                                <label class="form-check-label">イタリア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="ES">
                                                <label class="form-check-label">スペイン</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="PT">
                                                <label class="form-check-label">ポルトガル</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="NL">
                                                <label class="form-check-label">オランダ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="BE">
                                                <label class="form-check-label">ベルギー</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="CH">
                                                <label class="form-check-label">スイス</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="AT">
                                                <label class="form-check-label">オーストリア</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="SE">
                                                <label class="form-check-label">スウェーデン</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="NO">
                                                <label class="form-check-label">ノルウェー</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="DK">
                                                <label class="form-check-label">デンマーク</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="FI">
                                                <label class="form-check-label">フィンランド</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="IE">
                                                <label class="form-check-label">アイルランド</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="americasHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#americasCollapse" aria-expanded="false" aria-controls="americasCollapse">
                                    北米・南米
                                </button>
                            </h2>
                            <div id="americasCollapse" class="accordion-collapse collapse" aria-labelledby="americasHeading" data-bs-parent="#excludedCountriesAccordion">
                                <div class="accordion-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="US">
                                                <label class="form-check-label">アメリカ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="CA">
                                                <label class="form-check-label">カナダ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="MX">
                                                <label class="form-check-label">メキシコ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="BR">
                                                <label class="form-check-label">ブラジル</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="AR">
                                                <label class="form-check-label">アルゼンチン</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="CL">
                                                <label class="form-check-label">チリ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="CO">
                                                <label class="form-check-label">コロンビア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="PE">
                                                <label class="form-check-label">ペルー</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="VE">
                                                <label class="form-check-label">ベネズエラ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="EC">
                                                <label class="form-check-label">エクアドル</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="BO">
                                                <label class="form-check-label">ボリビア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="PY">
                                                <label class="form-check-label">パラグアイ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="UY">
                                                <label class="form-check-label">ウルグアイ</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="othersHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#othersCollapse" aria-expanded="false" aria-controls="othersCollapse">
                                    その他の地域
                                </button>
                            </h2>
                            <div id="othersCollapse" class="accordion-collapse collapse" aria-labelledby="othersHeading" data-bs-parent="#excludedCountriesAccordion">
                                <div class="accordion-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="AU">
                                                <label class="form-check-label">オーストラリア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="NZ">
                                                <label class="form-check-label">ニュージーランド</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="RU">
                                                <label class="form-check-label">ロシア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="TR">
                                                <label class="form-check-label">トルコ</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="ZA">
                                                <label class="form-check-label">南アフリカ</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="EG">
                                                <label class="form-check-label">エジプト</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="SA">
                                                <label class="form-check-label">サウジアラビア</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="AE">
                                                <label class="form-check-label">アラブ首長国連邦</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="IL">
                                                <label class="form-check-label">イスラエル</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" name="excludedCountries[]" value="IR">
                                                <label class="form-check-label">イラン</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- YouTube収益化サービス -->
            <div class="form-section">
                <h3 class="mb-4">YouTube収益化サービス</h3>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="youtubeMonetize" name="youtubeMonetize">
                        <label class="form-check-label" for="youtubeMonetize">利用する</label>
                    </div>
                </div>

                <div class="youtube-terms">
                    <p>YouTube収益化サービスに関する同意事項をご確認ください。</p>
                    <ul>
                        <li>YouTube収益化サービスを利用する場合、当社はあなたのコンテンツをYouTubeに掲載し、広告を表示することができます。</li>
                        <li>広告収入は当社と共有される場合があります。</li>
                        <li>YouTubeの利用規約に同意する必要があります。</li>
                    </ul>
                </div>
            </div>

            <!-- お支払い -->
            <div class="form-section">
                <h3 class="mb-4">お支払い</h3>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <div class="alert alert-info" role="alert">
                            <i class="fa fa-info-circle"></i> 料金: 20,000円 (税込)
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="payLater" name="payLater">
                            <label class="form-check-label" for="payLater">
                                後で支払う（申請後に支払い方法をご案内いたします）
                            </label>
                        </div>
                        <div id="paypal-button-container" class="text-center"></div>
                        <div id="payment-status" class="payment-status"></div>
                    </div>
                </div>
            </div>

            <!-- 送信ボタン -->
            <div class="text-center mt-4">
                <button type="submit" id="submitButton" class="btn btn-primary btn-lg">
                    <span class="button-text">申請する</span>
                    <span class="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true" style="display: none;"></span>
                </button>
            </div>
        </form>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">
                        <i class="fa fa-check-circle text-success me-2"></i> 申請完了
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fa fa-check-circle text-success" style="font-size: 4rem;"></i>
                    </div>
                    <p class="text-center">申請が正常に完了しました。</p>
                    <p class="text-center">ご登録いただいたメールアドレスに確認メールをお送りしましたので、ご確認ください。</p>
                    <div id="paymentInstructions" style="display: none;">
                        <hr>
                        <h6 class="text-center">お支払いについて</h6>
                        <p>後払いを選択された場合、以下の方法でお支払いいただけます：</p>
                        <ul>
                            <li>銀行振込</li>
                            <li>クレジットカード</li>
                            <li>PayPal</li>
                        </ul>
                        <p>お支払い方法の詳細は、確認メールに記載されています。</p>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary px-4" data-bs-dismiss="modal">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="footer-flex-container">
            <p class="text-uppercase small templatemo-copyright">Surroundio copyright © 2022 Nationalux Canada, All rights reserved.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script>
        $(document).ready(function() {
            let songCount = 0;
            let genreCount = 1;

            // Set minimum date to 3 weeks from today
            const releaseDateInput = document.getElementById('releaseDate');
            const today = new Date();
            const minDate = new Date(today);
            minDate.setDate(today.getDate() + 21); // 3 weeks = 21 days

            releaseDateInput.min = minDate.toISOString().split('T')[0];
            releaseDateInput.value = minDate.toISOString().split('T')[0];

            // Enable submit button initially
            document.querySelector('button[type="submit"]').disabled = false;

            // 楽曲追加ボタン クリックイベント
            $('#addSongButton').on('click', function() {
                const originalSong = $('#songs-container .song-entry:first').clone();
                songCount++;

                // 新しい楽曲番号設定
                originalSong.find('.song-number').text(songCount + 1);

                // 全ての input, select, textarea 初期化とインデックス更新
                originalSong.find('input, select, textarea').each(function() {
                    const elem = $(this);
                    if (elem.attr('name')) {
                        elem.attr('name', elem.attr('name').replace(/_\d+/, `_${songCount}`));
                    }
                    if (elem.attr('id')) {
                        elem.attr('id', elem.attr('id').replace(/_\d+/, `_${songCount}`));
                    }
                    elem.val('');
                });

                // コンテナID更新
                originalSong.find('[id]').each(function() {
                    const elem = $(this);
                    elem.attr('id', elem.attr('id').replace(/_\d+/, `_${songCount}`));
                });

                // アコーディオンIDとデータ属性の更新
                originalSong.find('.accordion').attr('id', `languageAccordion_${songCount}`);
                originalSong.find('.accordion-button')
                    .attr('data-bs-target', `#languageCollapse_${songCount}`)
                    .attr('aria-controls', `languageCollapse_${songCount}`);
                originalSong.find('.accordion-collapse')
                    .attr('id', `languageCollapse_${songCount}`)
                    .attr('aria-labelledby', `languageHeading_${songCount}`);

                // 削除ボタン表示とイベント設定
                originalSong.find('.remove-song').show().on('click', function() {
                    if ($('.song-entry').length > 1) {
                        $(this).closest('.song-entry').remove();
                        updateSongNumbers();
                    }
                });

                // 新しい楽曲追加
                $('#songs-container').append(originalSong);

                // 全ての楽曲の削除ボタン表示（最初の楽曲を除く）
                if ($('.song-entry').length > 1) {
                    $('.remove-song').show();
                }
            });

            // 入力フィールド追加/削除ボタン イベント
            $(document).on('click', '.add-field', function(e) {
                e.preventDefault();
                const container = $(this).closest('.mb-3');
                const inputGroup = $(this).closest('.input-group');
                const newGroup = inputGroup.clone(true);
                newGroup.find('input').val('');
                container.append(newGroup);
                container.find('.remove-field').prop('disabled', false);
            });

            $(document).on('click', '.remove-field', function(e) {
                e.preventDefault();
                const container = $(this).closest('.mb-3');
                const inputGroups = container.find('.input-group');
                if (inputGroups.length > 1) {
                    $(this).closest('.input-group').remove();
                    if (inputGroups.length === 2) {
                        container.find('.remove-field').last().prop('disabled', true);
                    }
                }
            });

            // 楽曲番号更新関数
            function updateSongNumbers() {
                $('.song-entry').each(function(index) {
                    $(this).find('.song-number').text(index + 1);
                });
            }

            // 初期状態設定
            if ($('.song-entry').length === 1) {
                $('.remove-song').hide();
            }

            // 各セクションの最初の削除ボタン無効化
            $('.mb-3').each(function() {
                if ($(this).find('.input-group').length === 1) {
                    $(this).find('.remove-field').prop('disabled', true);
                }
            });

            // アルバムカバー画像バリデーション
            $('#image').on('change', function() {
                const file = this.files[0];
                if (file) {
                    // ファイルサイズチェック (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('ファイルサイズは10MB以下にしてください。');
                        this.value = '';
                        return;
                    }

                    // 画像の寸法チェック
                    const img = new Image();
                    img.onload = function() {
                        if (this.width !== this.height) {
                            alert('画像は正方形（縦横同じサイズ）にしてください。');
                            $('#image').val('');
                            return;
                        }
                        if (this.width < 3000 || this.height < 3000) {
                            alert('画像サイズは3000x3000ピクセル以上にしてください。');
                            $('#image').val('');
                            return;
                        }
                    };
                    img.src = URL.createObjectURL(file);
                }
            });

            // Add unload handler
            window.addEventListener('unload', function() {
                // Cleanup any pending operations
                if (window.currentUpload) {
                    window.currentUpload.abort();
                }
            });

            // Form submission handler
            $('#albumForm').on('submit', async function(e) {
                e.preventDefault();
                e.stopPropagation(); // Prevent automatic scroll

                const submitButton = $('#submitButton');
                const buttonText = submitButton.find('.button-text');
                const spinner = submitButton.find('.spinner-border');
                const originalText = buttonText.text();

                // Disable button and show spinner
                submitButton.prop('disabled', true);
                buttonText.text('送信中...');
                spinner.show();

                const formData = new FormData(this);
                const payLater = $('#payLater').prop('checked');
                formData.append('payLater', payLater);

                // Handle platforms data - append each item individually
                $('input[name="platforms[]"]:checked').each(function() {
                    formData.append('platforms[]', $(this).val());
                });

                // Handle excluded countries data - append each item individually
                $('input[name="excludedCountries[]"]:checked').each(function() {
                    formData.append('excludedCountries[]', $(this).val());
                });

                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 60000);

                    const response = await fetch('https://pro-audio-jp-1.onrender.com/api/upload', {
                        method: 'POST',
                        body: formData,
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json',
                            'Origin': 'https://surroundio.today'
                        },
                        mode: 'cors',
                        credentials: 'same-origin',
                        keepalive: true,
                        referrerPolicy: 'no-referrer'
                    });

                    clearTimeout(timeoutId);

                    const responseText = await response.text();
                    let result = null;
                    try {
                        result = responseText ? JSON.parse(responseText) : null;
                    } catch (e) {
                        console.warn('JSON parsing failed:', e);
                        result = {
                            message: responseText
                        };
                    }

                    if (!response.ok) {
                        throw new Error(
                            result ?.message || `サーバーエラー (${response.status}): ${responseText || '応答内容なし'}`
                        );
                    }

                    if (!result) {
                        throw new Error('サーバーから有効な応答がありませんでした。');
                    }

                    // Show success message
                    $('#successMessage').show().text(result.message || 'アップロードが完了しました！');
                    $('#errorMessage').hide();

                    // Show payment instructions if pay later is selected
                    if (payLater) {
                        $('#paymentInstructions').show();
                    }

                    // Force scroll to top immediately before showing modal
                    document.body.scrollTop = 0; // For Safari
                    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera

                    // Show success modal
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();

                    // Reset form
                    $('#albumForm')[0].reset();

                    // Reset any dynamic content
                    $('.song-entry').not(':first').remove();
                    $('.song-entry:first').find('input, select, textarea').val('');
                    $('.song-entry:first').find('.remove-song').hide();
                    $('.mb-3').each(function() {
                        if ($(this).find('.input-group').length === 1) {
                            $(this).find('.remove-field').prop('disabled', true);
                        }
                    });

                } catch (error) {
                    console.error('Form submission error:', error);
                    const errorMessage = $('#errorMessage');
                    let errorText = `エラーが発生しました: ${error.message}`;
                    errorMessage.html(errorText).show();
                    $('#successMessage').hide();
                    errorMessage[0] ?.scrollIntoView({
                        behavior: 'smooth'
                    });

                } finally {
                    // Reset button state
                    submitButton.prop('disabled', false);
                    buttonText.text(originalText);
                    spinner.hide();
                }
            });

            // PayPal button initialization
            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: '20000'
                            }
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        $('#payment-status').removeClass('error').addClass('success')
                            .html('支払いが完了しました。')
                            .show();
                        // Store payment status in form data
                        $('#payment-status').data('paid', true);
                    });
                },
                onError: function(err) {
                    console.error('PayPal Error:', err);
                    $('#payment-status').removeClass('success').addClass('error')
                        .html('支払い処理中にエラーが発生しました。')
                        .show();
                    // Store payment status in form data
                    $('#payment-status').data('paid', false);
                },
                onCancel: function() {
                    $('#payment-status').removeClass('success').addClass('error')
                        .html('支払いがキャンセルされました。')
                        .show();
                    // Store payment status in form data
                    $('#payment-status').data('paid', false);
                }
            }).render('#paypal-button-container').catch(function(error) {
                console.error('PayPal Button Render Error:', error);
                $('#paypal-button-container').html('<div class="alert alert-danger">PayPalボタンの読み込みに失敗しました。ページを更新して再度お試しください。</div>');
            });

            // Toggle PayPal button visibility based on pay later checkbox
            $('#payLater').on('change', function() {
                if ($(this).prop('checked')) {
                    $('#paypal-button-container').hide();
                } else {
                    $('#paypal-button-container').show();
                }
            });
        });

        // 모바일 버전 제출 버튼 상태 관리 코드 제거 (중복 제거)
    </script>
</body>

</html>
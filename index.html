<!DOCTYPE html>

<head>
    <!--
    	Pro Audio
    	http://www.templatemo.com/preview/templatemo_429_pro_audio
    -->
    <title>Surroundio - 专业音频处理服务</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/templatemo_style.css" rel="stylesheet" type="text/css">
    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <style>
        /* Pastel button styles */
        .btn-pastel {
            padding: 18px 40px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none !important;
            display: inline-block;
            margin: 5px;
            color: #2C3333 !important;
            font-size: 16px;
        }

        .btn-pastel:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-pastel.green {
            background-color: #C1FFD7 !important;  /* 더 밝은 파스텔 그린 */
        }
        .btn-pastel.green:hover {
            background-color: #B4EBC5 !important;
        }

        .btn-pastel.pink {
            background-color: #FFE5F1 !important;  /* 더 밝은 파스텔 핑크 */
        }
        .btn-pastel.pink:hover {
            background-color: #FFD6E8 !important;
        }

        .btn-pastel.blue {
            background-color: #D4F1F4 !important;  /* 더 밝은 파스텔 블루 */
        }
        .btn-pastel.blue:hover {
            background-color: #C1E8ED !important;
        }

        /* 모바일 최적화 스타일 */
        #accordionContent {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease;
        }

        /* About Section Styles */
        .about-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 30px;
        }

        .about-content {
            display: flex;
            align-items: center;
            gap: 50px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .about-image-container {
            flex: 0 0 65%;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            height: 400px;
        }

        .about-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        .about-content:hover .about-img {
            transform: scale(1.05);
        }

        .about-text {
            flex: 0 0 35%;
            padding: 20px;
        }

        .about-text p {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            margin: 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .about-container {
                padding: 0 15px;
            }

            .about-content {
                flex-direction: column;
                padding: 20px;
            }

            .about-image-container {
                flex: none;
                width: 100%;
                height: 300px;
                margin-bottom: 20px;
            }

            .about-text {
                flex: none;
                width: 100%;
                padding: 0;
            }

            .about-text p {
                text-align: center;
            }
        }

        /* 원형 프로그레스 스타일 추가 */
        .circular-progress-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .circular-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(rgba(255, 102, 51, 0.3) 0deg, transparent 0deg);
            transition: background 0.1s linear;
        }

        .templatemo-album-images {
            position: relative;
            display: inline-block;
        }

        /* 햄버거 메뉴 스타일 수정 */
        .hamburger-lines {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 24px;
            width: 30px;
            position: relative;
            gap: 6px;
        }

        .hamburger-lines span {
            display: block;
            height: 2px;
            width: 100%;
            background-color: white;
            margin: 0;
        }

        /* 로딩 상태 표시를 위한 스타일 추가 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            margin-top: 10px;
            font-size: 1.2em;
        }
    </style>
</head>

<body>
    <div class="templatemo-header">
        <div class="templatemo-header-gradient-bg"></div>
        <div class="container">
            <h1 class="text-center text-uppercase templatemo-site-name"><span class="blue">Surround</span>io</h1>
            <nav class="hidden-xs text-center text-uppercase templatemo-nav">
                <ul class="menu-holder">
                    <li class="active"><a href="#home" style="color: #000;">首页</a></li>
                    <li><a href="#about" style="color: #000;">服务</a></li>
                    <li><a href="#albums" style="color: #000;">专辑</a></li>
                    <li><a href="#subscribe" style="color: #000;">预约申请</a></li>
                    <li><a href="#contact" style="color: #000;">联系我们</a></li>
                </ul>
            </nav>
            <div class="text-right visible-xs">
                <a href="#" id="mobile_menu">
                    <div class="hamburger-lines">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div class="templatemo-header-image"></div>
    <div class="container">
        <section id="home" class="templatemo-section">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <img src="images/home.png" alt="Banner" class="img-responsive center-block">
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <h2 class="text-right">High Quality</h2>
                    <h3 class="text-uppercase text-right margin-top-30">只需1000元</h3>
                    <h4 class="text-uppercase text-right">从专辑制作到全球发行</h4>
                    <p class="text-right margin-top-30">Surroundio是一家引领沉浸式三维音效内容与AI音频技术创新的专业企业。只需100,000日元，基于100万以上数据库的AI引擎和专业音频工程师提供音频修复、混音、母带制作服务，支持160多个全球平台的发行。同时为成长中的音乐人提供额外福利，支持持续发展。</p>
                    <a href="#subscribe" class="pull-right btn-pastel blue margin-top-30 text-uppercase">立即预约</a>
                </div>
            </div>
        </section>
        <img src="images/border.png" alt="Border" class="templatemo-border">
        <section id="about" class="templatemo-section">
            <h2 class="text-uppercase text-center">服务</h2>
            <div class="about-container margin-top-50">
                <div class="about-content">
                    <div class="about-image-container">
                        <img src="images/about.jpg" alt="About" class="about-img">
                    </div>
                    <div class="about-text">
                        <p>Surroundio是与全球知名品牌Shutterstock共同推出的全新音频平台。基于100万以上专业母带制作数据，为您的音乐提供更清晰、更丰富的音效表现力。上传音频后，完成音频修复、混音、母带制作，支持全球160多个音乐平台的发行。只需上传音频一次，即可获得专业级的最终效果。此外，Surroundio为成长中的音乐人提供曝光机会、合作资源、品牌推广支持，逐步支持音乐梦想的实现。</p>
                    </div>
                </div>
            </div>
        </section>
        <img src="images/border.png" alt="Border" class="templatemo-border">
        <section id="services" class="templatemo-section">
            <div class="row margin-top-50">
                <article class="col-lg-4 col-md-4 col-sm-4 col-xs-12 templatemo-product">
                    <img src="images/services/1.png" alt="AI Analysis" class="center-block">
                    <h3 class="text-uppercase text-center">AI精密分析</h3>
                    <p class="text-center">基于100万以上母带制作数据库的创新AI引擎，深度分析比较您的音频，智能识别音质弱点，进行专业级音质提升和优化处理。</p>
                </article>
                <article class="col-lg-4 col-md-4 col-sm-4 col-xs-12 templatemo-product">
                    <img src="images/services/3.png" alt="Professional Engineers" class="center-block">
                    <h3 class="text-uppercase text-center">专业工程师</h3>
                    <p class="text-center">邀请经验丰富的专业母带制作工程师，对每个作品进行详细审查和音效调整。从细节打磨到整体音质控制，全部采用人工精密修正，确保行业最高水准。</p>
                </article>
                <article class="col-lg-4 col-md-4 col-sm-4 col-xs-12 templatemo-product">
                    <img src="images/services/2.png" alt="Global Distribution" class="center-block">
                    <h3 class="text-uppercase text-center">一键全球发行</h3>
                    <p class="text-center">您的音乐将发行到Amazon Music、Spotify、腾讯音乐等全球主要平台。通过Surroundio，您的作品将传达给全世界的听众，提高曝光度，实现真正的国际化。开拓海外发行渠道，节省时间和成本，为您的创作带来更大影响力。</p>
                </article>
            </div>
        </section>
        <img src="images/border.png" alt="Border" class="templatemo-border">
        <section id="albums" class="templatemo-section">
            <h2 class="text-uppercase text-center">专辑示例</h2>
            <p class="text-center" style="margin-top: 20px; color: #666; font-size: 14px;">比较音源：点击文字开始播放或暂停。</p>
            <div class="row margin-top-50 templatemo-albums-container">
                <div class="col-lg-6 col-md-6 col-sm-6 templatemo-album">
                    <div class="templatemo-album-images">
                        <img src="images/albums/1.jpg" alt="Album 1" class="img-circle templatemo-album-img">
                        <img src="images/album-img-bg.png" alt="Album background" class="templatemo-album-img-bg">
                        <img src="images/circle_gray.png" alt="Album frame" class="templatemo-album-img-frame">
                        <audio id="audio1" src="audio\song1.mp3"></audio>
                        <audio id="audio2" src="audio\song2.mp3"></audio>
                        <div class="audio-player" id="player1" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(1)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress1"></div>
                            </div>
                        </div>
                        <div class="audio-player" id="player2" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(2)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="templatemo-album-description">
                        <p class="templatemo-album-name" onclick="togglePlay(1)" style="cursor: pointer;">处理前</p>
                        <p class="templatemo-album-artist" onclick="togglePlay(2)" style="cursor: pointer;">处理后</p>
                        <p class="templatemo-album-date" onclick="stopAudio(1)" style="cursor: pointer;">停止</p>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 templatemo-album">
                    <div class="templatemo-album-images">
                        <img src="images/albums/2.jpg" alt="Album 2" class="img-circle templatemo-album-img">
                        <img src="images/album-img-bg.png" alt="Album background" class="templatemo-album-img-bg">
                        <img src="images/circle_gray.png" alt="Album frame" class="templatemo-album-img-frame">
                        <audio id="audio3" src="audio\song3.mp3"></audio>
                        <audio id="audio4" src="audio\song4.mp3"></audio>
                        <div class="audio-player" id="player3" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(3)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress3"></div>
                            </div>
                        </div>
                        <div class="audio-player" id="player4" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(4)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress4"></div>
                            </div>
                        </div>
                    </div>
                    <div class="templatemo-album-description">
                        <p class="templatemo-album-name" onclick="togglePlay(3)" style="cursor: pointer;">处理前</p>
                        <p class="templatemo-album-artist" onclick="togglePlay(4)" style="cursor: pointer;">处理后</p>
                        <p class="templatemo-album-date" onclick="stopAudio(2)" style="cursor: pointer;">停止</p>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 templatemo-album">
                    <div class="templatemo-album-images">
                        <img src="images/albums/3.jpg" alt="Album 3" class="img-circle templatemo-album-img">
                        <img src="images/album-img-bg.png" alt="Album background" class="templatemo-album-img-bg">
                        <img src="images/circle_gray.png" alt="Album frame" class="templatemo-album-img-frame">
                        <audio id="audio5" src="audio\song5.mp3"></audio>
                        <audio id="audio6" src="audio\song6.mp3"></audio>
                        <div class="audio-player" id="player5" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(5)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress5"></div>
                            </div>
                        </div>
                        <div class="audio-player" id="player6" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(6)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress6"></div>
                            </div>
                        </div>
                    </div>
                    <div class="templatemo-album-description">
                        <p class="templatemo-album-name" onclick="togglePlay(5)" style="cursor: pointer;">处理前</p>
                        <p class="templatemo-album-artist" onclick="togglePlay(6)" style="cursor: pointer;">处理后</p>
                        <p class="templatemo-album-date" onclick="stopAudio(3)" style="cursor: pointer;">停止</p>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 templatemo-album">
                    <div class="templatemo-album-images">
                        <img src="images/albums/4.jpg" alt="Album 4" class="img-circle templatemo-album-img">
                        <img src="images/album-img-bg.png" alt="Album background" class="templatemo-album-img-bg">
                        <img src="images/circle_gray.png" alt="Album frame" class="templatemo-album-img-frame">
                        <audio id="audio7" src="audio\song7.mp3"></audio>
                        <audio id="audio8" src="audio\song8.mp3"></audio>
                        <div class="audio-player" id="player7" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(7)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress7"></div>
                            </div>
                        </div>
                        <div class="audio-player" id="player8" style="display: none;">
                            <div class="play-pause-btn" onclick="togglePlay(8)">
                                <i class="fa fa-play"></i>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress8"></div>
                            </div>
                        </div>
                    </div>
                    <div class="templatemo-album-description">
                        <p class="templatemo-album-name" onclick="togglePlay(7)" style="cursor: pointer;">处理前</p>
                        <p class="templatemo-album-artist" onclick="togglePlay(8)" style="cursor: pointer;">处理后</p>
                        <p class="templatemo-album-date" onclick="stopAudio(4)" style="cursor: pointer;">停止</p>
                    </div>
                </div>
            </div>
        </section>
        <img src="images/border.png" alt="Border" class="templatemo-border">
        <section id="subscribe" class="templatemo-section">
            <h2 class="text-uppercase text-center">预约申请</h2>
            <div class="upload-section margin-top-50">
                <a href="application.html" class="btn-pastel pink text-uppercase">📩 专辑制作申请</a>
                <a href="reservation.html" class="btn-pastel green text-uppercase" style="margin-left: 20px;">🔍 预约确认</a>
            </div>
        </section>
        <img src="images/border.png" alt="Border" class="templatemo-border">
        <section id="contact" class="templatemo-section">
            <h2 class="text-uppercase text-center">联系我们</h2>
            <div class="margin-top-50">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <div id="map-canvas"></div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <form id="contactForm" class="tm-contact-form">
                        <div class="form-group">
                            <input type="text" id="contact_name" class="form-control" placeholder="姓名..." required />
                        </div>
                        <div class="form-group">
                            <input type="email" id="contact_email" class="form-control" placeholder="邮箱..." required />
                        </div>
                        <div class="form-group">
                            <input type="text" id="contact_subject" class="form-control" placeholder="主题..." required />
                        </div>
                        <div class="form-group">
                            <textarea id="contact_message" class="form-control" rows="8" placeholder="消息内容..." required></textarea>
                        </div>
                        <button type="submit" class="btn text-uppercase tm-dark-bg tm-orange-text tm-send-btn btn-gradient">发送</button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <footer class="templatemo-footer margin-top-50">
        <div class="container">
            <div class="footer-flex-container">
                <p class="text-uppercase small templatemo-copyright">Surroundio copyright © 2022 Nationalux Canada, All rights reserved.</p>
            </div>
            <img src="images/go-to-top.png" alt="Go to top" class="img-responsive tm-go-to-top">
        </div>
    </footer>
    <div id="responsive-menu" class="visible-xs">
        <ul class="menu-holder">
            <li><a href="#home"><i class="fa fa-home"></i> 首页</a></li>
            <li><a href="#about"><i class="fa fa-info-circle"></i> 服务</a></li>
            <li><a href="#albums"><i class="fa fa-music"></i> 专辑</a></li>
            <li><a href="#subscribe"><i class="fa fa-calendar"></i> 预约申请</a></li>
            <li><a href="#contact"><i class="fa fa-envelope"></i> 联系我们</a></li>
            <li class="menu-divider"></li>
            <li><a href="./terms-template.html?page=publish-rules"><i class="fa fa-file-text"></i> 发布规则</a></li>
            <li><a href="./terms-template.html?page=terms-of-use"><i class="fa fa-file-text"></i> 使用条款</a></li>
            <li><a href="./terms-template.html?page=copyright-management"><i class="fa fa-file-text"></i> 版权管理服务使用条款</a></li>
        </ul>
    </div>
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text">发送中...</div>
        </div>
    </div>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="js/templatemo_script.js"></script>
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/form-handler.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQXWJ6QWnA3X0JNzeykUpFLJCPxFb68r0&callback=initMap" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        function openAccordion() {
            const content = document.getElementById('accordionContent');
            if (!content) return;  // content가 없으면 함수 종료
            
            const currentHeight = content.style.maxHeight;
            if (currentHeight && currentHeight !== '0px') {
                content.style.maxHeight = '0px';
            } else {
                content.style.maxHeight = '2000px';
            }
        }

        async function handleSubmit(event) {
            event.preventDefault();
            console.log('Form submission started');

            const form = document.getElementById('albumForm');
            const submitButton = form.querySelector('button[type="submit"]');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const formData = new FormData(form);

            try {
                console.log('Form data:', {
                    name: formData.get('name'),
                    age: formData.get('age'),
                    gender: formData.get('gender'),
                    email: formData.get('email'),
                    date: formData.get('date'),
                    time: formData.get('time'),
                    mainRequest: formData.get('mainRequest'),
                    note: formData.get('note'),
                    memberKey: formData.get('memberKey'),
                    audio: formData.get('audio'),
                    image: formData.get('image')
                });

                // 로딩 상태 표시
                submitButton.disabled = true;
                loadingOverlay.style.display = 'flex';
                console.log('Loading state activated');

                // 날짜 포맷 처리
                const dateValue = $("#date").datepicker("getDate");
                if (dateValue) {
                    const year = dateValue.getFullYear();
                    const month = String(dateValue.getMonth() + 1).padStart(2, '0');
                    const day = String(dateValue.getDate()).padStart(2, '0');
                    formData.set('date', `${year}年${month}月${day}日`);
                    console.log('Date formatted:', formData.get('date'));
                }

                // 언어 설정
                formData.append('language', 'ja');

                console.log('Sending request to:', 'https://pro-audio.onrender.com/upload');
                const response = await fetch('https://pro-audio.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });

                console.log('Response received:', {
                    status: response.status,
                    statusText: response.statusText
                });

                const result = await response.json();
                console.log('Response data:', result);
                
                if (!response.ok) {
                    throw new Error(result.message || '上传失败');
                }

                // 성공 시
                alert('上传完成！');
                form.reset();
                document.querySelector('.file-status').textContent = '没有选择文件';
                document.querySelector('.file-select-button').textContent = '选择文件';
                
                // 아코디언 닫기
                document.getElementById('accordionContent').style.maxHeight = '0px';

            } catch (error) {
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack
                });
                alert(error.message || '发生错误，请再试一次。');
            } finally {
                // 로딩 상태 해제
                submitButton.disabled = false;
                loadingOverlay.style.display = 'none';
                console.log('Form submission completed');
            }
        }

        // 폼 제출 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded');
            const form = document.getElementById('albumForm');
            if (form) {
                console.log('Form found, attaching submit event listener');
                form.addEventListener('submit', handleSubmit);
            } else {
                console.error('Form not found!');
            }
        });

        // Contact Form Submission
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('contact_name').value,
                email: document.getElementById('contact_email').value,
                subject: document.getElementById('contact_subject').value,
                message: document.getElementById('contact_message').value
            };

            // EmailJS 초기화
            (function() {
                emailjs.init("jfle4pXv1E8FEPCJv");
            })();

            // 이메일 전송
            emailjs.send(
                "service_jsn3q06",
                "template_ha65rt7",
                {
                    to_email: "kmat0@naver.com",
                    from_name: formData.name,
                    from_email: formData.email,
                    subject: formData.subject,
                    message: formData.message,
                    language: 'zh' // 언어 식별자 추가
                }
            ).then(
                function(response) {
                    alert("消息发送成功！");
                    document.getElementById('contactForm').reset();
                },
                function(error) {
                    console.error("发送失败:", error);
                    alert("消息发送失败，请重试。");
                }
            );
        });

        // Audio Player Functionality
        let currentlyPlaying = null;
        let currentPlayer = null;
        let lastPlaybackTime = {};
        const players = {};

        function updateCircularProgress(audio, albumImage) {
            if (!audio.duration) return;
            const progress = (audio.currentTime / audio.duration) * 360;
            const circularProgress = albumImage.querySelector('.circular-progress');
            if (circularProgress) {
                circularProgress.style.background = `conic-gradient(rgba(255, 102, 51, 0.3) ${progress}deg, transparent ${progress}deg)`;
            }
        }

        function stopAudio(albumId) {
            // Each album has two tracks, so we need to stop both
            const trackIds = [albumId * 2 - 1, albumId * 2];
            
            trackIds.forEach(trackId => {
                const audio = document.getElementById(`audio${trackId}`);
                const player = document.getElementById(`player${trackId}`);
                
                if (audio) {
                    // Stop and reset the audio
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Reset the player UI
                    if (player) {
                        const playIcon = player.querySelector('.play-pause-btn i');
                        const progress = player.querySelector('.progress');
                        if (playIcon) playIcon.className = 'fa fa-play';
                        if (progress) progress.style.width = '0%';
                        player.style.display = 'none';
                    }
                    
                    // Reset the circular progress
                    const albumImage = player.closest('.templatemo-album-images');
                    if (albumImage) {
                        const circularProgress = albumImage.querySelector('.circular-progress');
                        if (circularProgress) {
                            circularProgress.style.background = 'conic-gradient(rgba(255, 102, 51, 0.3) 0deg, transparent 0deg)';
                        }
                    }

                    // Reset stored playback time for this track
                    if (lastPlaybackTime[audio.id]) {
                        delete lastPlaybackTime[audio.id];
                    }

                    // Reset current playing states if this was the playing track
                    if (currentlyPlaying === audio) {
                        currentlyPlaying = null;
                        currentPlayer = null;
                    }
                }
            });
        }

        function togglePlay(id) {
            const audio = document.getElementById(`audio${id}`);
            const player = document.getElementById(`player${id}`);
            const albumImage = player.closest('.templatemo-album-images');
            const playBtn = player.querySelector('.play-pause-btn');
            const playIcon = playBtn.querySelector('i');
            const progress = document.getElementById(`progress${id}`);

            // Add circular progress container if not exists
            if (!albumImage.querySelector('.circular-progress-container')) {
                const container = document.createElement('div');
                container.className = 'circular-progress-container';
                const circularProgress = document.createElement('div');
                circularProgress.className = 'circular-progress';
                container.appendChild(circularProgress);
                albumImage.appendChild(container);
            }

            if (currentlyPlaying && currentlyPlaying !== audio) {
                lastPlaybackTime[currentlyPlaying.id] = currentlyPlaying.currentTime;
                currentlyPlaying.pause();
                const oldPlayer = currentPlayer;
                const oldPlayIcon = oldPlayer.querySelector('.play-pause-btn i');
                oldPlayIcon.className = 'fa fa-play';
                oldPlayer.style.display = 'none';
                
                const oldAlbumImage = oldPlayer.closest('.templatemo-album-images');
                const oldCircularProgress = oldAlbumImage.querySelector('.circular-progress');
                if (oldCircularProgress) {
                    oldCircularProgress.style.background = 'conic-gradient(rgba(255, 102, 51, 0.3) 0deg, transparent 0deg)';
                }

                if (lastPlaybackTime[audio.id]) {
                    audio.currentTime = lastPlaybackTime[audio.id];
                }
            }

            if (audio.paused) {
                if (lastPlaybackTime[audio.id]) {
                    audio.currentTime = lastPlaybackTime[audio.id];
                }
                
                audio.play();
                playIcon.className = 'fa fa-pause';
                currentlyPlaying = audio;
                currentPlayer = player;
                updateCircularProgress(audio, albumImage);
            } else {
                audio.pause();
                lastPlaybackTime[audio.id] = audio.currentTime;
                playIcon.className = 'fa fa-play';
                const circularProgress = albumImage.querySelector('.circular-progress');
                if (circularProgress) {
                    circularProgress.style.background = 'conic-gradient(rgba(255, 102, 51, 0.3) 0deg, transparent 0deg)';
                }
                currentlyPlaying = null;
                currentPlayer = null;
            }

            if (!players[id]) {
                players[id] = true;
                audio.addEventListener('timeupdate', () => {
                    const progressPercent = (audio.currentTime / audio.duration) * 100;
                    progress.style.width = `${progressPercent}%`;
                    updateCircularProgress(audio, albumImage);
                });

                audio.addEventListener('ended', () => {
                    playIcon.className = 'fa fa-play';
                    progress.style.width = '0%';
                    const circularProgress = albumImage.querySelector('.circular-progress');
                    if (circularProgress) {
                        circularProgress.style.background = 'conic-gradient(rgba(255, 102, 51, 0.3) 0deg, transparent 0deg)';
                    }
                    currentlyPlaying = null;
                    currentPlayer = null;
                    lastPlaybackTime[audio.id] = 0;
                });
            }
        }

        // カレンダー関連テキスト変更
        const dateInput = document.getElementById('date');
        if (dateInput) {
            dateInput.addEventListener('focus', function() {
                // カレンダーの曜日名を日本語に変更
                const weekdayLabels = document.querySelectorAll('.ui-datepicker-calendar th');
                if (weekdayLabels.length) {
                    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
                    weekdayLabels.forEach((label, index) => {
                        label.textContent = weekdays[index];
                    });
                }
            });
        }

        $(document).ready(function() {
            if ($.datepicker) {
                // カレンダー設定
                $.datepicker.setDefaults({
                    dateFormat: 'yy年mm月dd日',
                    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                    monthNamesShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                    dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
                    dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],
                    dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],
                    showMonthAfterYear: true,
                    yearSuffix: '年',
                    changeMonth: true,
                    changeYear: true,
                    beforeShow: function(input, inst) {
                        inst.dpDiv.addClass('custom-datepicker');
                    }
                });

                $("#date").datepicker();
            }

            // 時間入力設定
            const timeInput = document.getElementById('time');
            if (timeInput) {
                $(timeInput).on('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');

                    // 時間、分、秒制限
                    if (value.length >= 2) {
                        let hours = value.substring(0, 2);
                        if (parseInt(hours) > 23) hours = '23';
                        value = hours + value.substring(2);
                    }
                    if (value.length >= 4) {
                        let minutes = value.substring(2, 4);
                        if (parseInt(minutes) > 59) minutes = '59';
                        value = value.substring(0, 2) + minutes + value.substring(4);
                    }
                    if (value.length >= 6) {
                        let seconds = value.substring(4, 6);
                        if (parseInt(seconds) > 59) seconds = '59';
                        value = value.substring(0, 4) + seconds;
                    }

                    // 形式指定 (HH:mm:ss)
                    let formatted = '';
                    if (value.length > 0) formatted = value.substring(0, 2);
                    if (value.length > 2) formatted += ':' + value.substring(2, 4);
                    if (value.length > 4) formatted += ':' + value.substring(4, 6);

                    e.target.value = formatted;

                    // 日本語形式表示
                    if (value.length === 6) {
                        const [h, m, s] = [value.substring(0, 2), value.substring(2, 4), value.substring(4, 6)];
                        document.querySelector('.time-display').textContent = `${h}时${m}分${s}秒`;
                    } else {
                        document.querySelector('.time-display').textContent = '请输入时间 (24小时制)';
                    }
                });

                // フォーカスが外れると完全な形式チェック
                $(timeInput).on('blur', function(e) {
                    const value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0 && value.length < 6) {
                        let padded = value.padEnd(6, '0');
                        let formatted = padded.substring(0, 2) + ':' +
                            padded.substring(2, 4) + ':' +
                            padded.substring(4, 6);
                        e.target.value = formatted;

                        const [h, m, s] = [padded.substring(0, 2), padded.substring(2, 4), padded.substring(4, 6)];
                        document.querySelector('.time-display').textContent = `${h}时${m}分${s}秒`;
                    }
                });
            }

            // ファイル選択イベント
            const fileInput = document.getElementById('audio');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const fileName = e.target.files[0]?.name;
                    const statusElement = document.querySelector('.file-status');
                    statusElement.textContent = fileName || '没有选择文件';

                    // ファイルが選択されるとボタンテキスト変更
                    const buttonElement = document.querySelector('.file-select-button');
                    buttonElement.textContent = fileName ? '更改文件' : '选择文件';
                });
            }

            // 모바일 메뉴 토글
            $('#mobile_menu').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $('#responsive-menu').show().animate({right: 0});
            });

            // 메뉴 항목 클릭시 메뉴 닫기
            $('#responsive-menu a').on('click', function() {
                $('#responsive-menu').animate({right: -1500}, function() {
                    $(this).hide();
                });
            });

            // 메뉴 외부 클릭시 닫기
            $('body').on('click', function(e) {
                if (!$(e.target).closest('#mobile_menu').length && !$(e.target).closest('#responsive-menu').length) {
                    if ($('#responsive-menu').is(':visible')) {
                        $('#responsive-menu').animate({right: -1500}, function() {
                            $(this).hide();
                        });
                    }
                }
            });

            // 창 크기 변경시 처리
            $(window).on('load resize', function() {
                if ($(window).width() > 768) {
                    $('#responsive-menu').css({right: -1500}).hide();
                }
            });
        });

        // Google Maps initialization
        function initMap() {
            const location = { lat: 37.5665, lng: 126.9780 };
            const mapStyles = [
                {
                    "featureType": "all",
                    "elementType": "geometry",
                    "stylers": [{"saturation": -100}, {"lightness": 50}]
                },
                {
                    "featureType": "road",
                    "elementType": "geometry",
                    "stylers": [{"lightness": 100}]
                }
            ];

            const mapOptions = {
                center: location,
                zoom: 15,
                styles: mapStyles,
                disableDefaultUI: true,
                zoomControl: true
            };

            const map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
            const marker = new google.maps.Marker({
                position: location,
                map: map,
                animation: google.maps.Animation.DROP,
                title: 'Surroundio'
            });

            const contentString = 
                '<div style="padding: 15px; max-width: 200px;">' +
                '<h4 style="margin: 0 0 10px;">Surroundio</h4>' +
                '<p style="margin: 0;">专业音频处理与发行服务</p>' +
                '</div>';

            const infowindow = new google.maps.InfoWindow({
                content: contentString
            });

            marker.addListener('click', () => {
                infowindow.open(map, marker);
            });
        }

        // ページロード時地図初期化
        google.maps.event.addDomListener(window, 'load', initMap);
    </script>
</body>

</html>